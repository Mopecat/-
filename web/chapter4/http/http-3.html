<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HTTP 回顾 | 前端进阶之路</title>
    <meta name="description" content="前端学习记录">
    
    
    <link rel="preload" href="/web/assets/css/0.styles.3c55b503.css" as="style"><link rel="preload" href="/web/assets/js/app.86484ff8.js" as="script"><link rel="preload" href="/web/assets/js/2.977cf486.js" as="script"><link rel="preload" href="/web/assets/js/27.161a4fb8.js" as="script"><link rel="prefetch" href="/web/assets/js/10.62195373.js"><link rel="prefetch" href="/web/assets/js/11.f469e459.js"><link rel="prefetch" href="/web/assets/js/12.13ee9d46.js"><link rel="prefetch" href="/web/assets/js/13.360e90e0.js"><link rel="prefetch" href="/web/assets/js/14.8a8cfe81.js"><link rel="prefetch" href="/web/assets/js/15.611f3a7e.js"><link rel="prefetch" href="/web/assets/js/16.d3aa98b2.js"><link rel="prefetch" href="/web/assets/js/17.5068ae28.js"><link rel="prefetch" href="/web/assets/js/18.b2b8c636.js"><link rel="prefetch" href="/web/assets/js/19.9b38bcf8.js"><link rel="prefetch" href="/web/assets/js/20.764950cd.js"><link rel="prefetch" href="/web/assets/js/21.7c4986bc.js"><link rel="prefetch" href="/web/assets/js/22.6a992c02.js"><link rel="prefetch" href="/web/assets/js/23.99456b43.js"><link rel="prefetch" href="/web/assets/js/24.1a24e035.js"><link rel="prefetch" href="/web/assets/js/25.828281dd.js"><link rel="prefetch" href="/web/assets/js/26.ddd4c3ac.js"><link rel="prefetch" href="/web/assets/js/28.50aa7468.js"><link rel="prefetch" href="/web/assets/js/29.548de805.js"><link rel="prefetch" href="/web/assets/js/3.42674c08.js"><link rel="prefetch" href="/web/assets/js/30.4494096b.js"><link rel="prefetch" href="/web/assets/js/4.86ae4f4a.js"><link rel="prefetch" href="/web/assets/js/5.7f33e53f.js"><link rel="prefetch" href="/web/assets/js/6.19816c28.js"><link rel="prefetch" href="/web/assets/js/7.2854b8cf.js"><link rel="prefetch" href="/web/assets/js/8.0508d119.js"><link rel="prefetch" href="/web/assets/js/9.43c29797.js">
    <link rel="stylesheet" href="/web/assets/css/0.styles.3c55b503.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/web/" class="home-link router-link-active"><!----> <span class="site-name">前端进阶之路</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/web/chapter1/" class="sidebar-link">面试题记录</a></li><li><a href="/web/chapter2/" class="sidebar-link">设计模式学习记录</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript 进阶笔记</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Node 学习记录</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/chapter4/" class="sidebar-link">Node 相关笔记</a></li><li><a href="/web/chapter4/core/" class="sidebar-link">Node 核心模块</a></li><li><a href="/web/chapter4/http/http-1.html" class="sidebar-link">HTTP核心概念</a></li><li><a href="/web/chapter4/http/http-2.html" class="sidebar-link">HTTP中Header的应用</a></li><li><a href="/web/chapter4/http/http-3.html" class="active sidebar-link">HTTP 回顾</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/chapter4/http/http-3.html#_1-在浏览器地址栏输入-url-按下回车后究竟发生了什么" class="sidebar-link">1.在浏览器地址栏输入 URL,按下回车后究竟发生了什么?</a></li><li class="sidebar-sub-header"><a href="/web/chapter4/http/http-3.html#_2-页面的性能优化" class="sidebar-link">2.页面的性能优化</a></li><li class="sidebar-sub-header"><a href="/web/chapter4/http/http-3.html#_3-常见的优化" class="sidebar-link">3.常见的优化</a></li><li class="sidebar-sub-header"><a href="/web/chapter4/http/http-3.html#_4-http-状态码" class="sidebar-link">4.HTTP 状态码</a></li><li class="sidebar-sub-header"><a href="/web/chapter4/http/http-3.html#_5-http-服务创建" class="sidebar-link">5. HTTP 服务创建</a></li><li class="sidebar-sub-header"><a href="/web/chapter4/http/http-3.html#_6-http-其他-header-的应用" class="sidebar-link">6.Http 其他 header 的应用</a></li></ul></li><li><a href="/web/chapter4/koa/" class="sidebar-link">koa 原理</a></li></ul></section></li><li><a href="/web/chapter5/" class="sidebar-link">npm 学习记录</a></li><li><a href="/web/chapter6/" class="sidebar-link">性能优化</a></li><li><a href="/web/chapter7/" class="sidebar-link">数据结构与算法</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="http-回顾"><a href="#http-回顾" class="header-anchor">#</a> HTTP 回顾</h1> <h2 id="_1-在浏览器地址栏输入-url-按下回车后究竟发生了什么"><a href="#_1-在浏览器地址栏输入-url-按下回车后究竟发生了什么" class="header-anchor">#</a> 1.在浏览器<em>地址</em>栏<em>输入 URL</em>,按下回车后究竟发生了什么?</h2> <p>1). 浏览器通过 DNS 将 url 地址解析为 ip (如果有缓存直接返回缓存,否则递归解析)</p> <p>2).通过 DNS 解析得到了目标服务器的 IP 地址后，与服务器建立 TCP 连接。</p> <pre><code>- ip协议： 选择传输路线,负责找到
- tcp协议： 三次握手，分片，可靠传输，重新发送的机制
</code></pre> <p>3).浏览器通过 http 协议发送请求 (增加 http 的报文信息) 头 体 行</p> <p>4).服务器接受请求后，查库，读文件，拼接好返回的 http 响应</p> <p>5).浏览器收到 html，开始渲染</p> <p>6).解析 html 为 dom，解析 css 为 css-tree,最终生成 render-tree 阻塞渲染</p> <p>7).遍历渲染树开始布局，计算每个节点的位置大小信息</p> <p>8).将渲染树每个节点绘制到屏幕</p> <p>9).加载 js 文件,运行 js 脚本</p> <p>10).reflow (样式)与 repaint(位置)</p> <p><img src="http://img.zhufengpeixun.cn/domrender.jpg" alt="domrender"></p> <h2 id="_2-页面的性能优化"><a href="#_2-页面的性能优化" class="header-anchor">#</a> 2.页面的性能优化</h2> <p><img src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1562322737439&amp;di=6940a8a49d168d9690f3732794b01a4e&amp;imgtype=0&amp;src=http%3A%2F%2Fimg2018.cnblogs.com%2Fblog%2F1555757%2F201812%2F1555757-20181210173358459-380857182.png" alt="img"></p> <h2 id="_3-常见的优化"><a href="#_3-常见的优化" class="header-anchor">#</a> 3.常见的优化</h2> <ul><li><p>缓存</p> <p>HTTP 中缓存 强制缓存和对比缓存的应用(304) memory disk</p> <p>service worker 和 cache api (离线缓存 HTTPS) pwa</p> <p>Push Cache 推送缓存 HTTP/2 中的内容</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Cache<span class="token operator">-</span>Control <span class="token operator">/</span> Expires
If<span class="token operator">-</span>modified<span class="token operator">-</span>since <span class="token operator">/</span> Last<span class="token operator">-</span>modified
Etag <span class="token operator">/</span> <span class="token keyword">if</span><span class="token operator">-</span>none<span class="token operator">-</span>match
</code></pre></div></li></ul> <ul><li><p>压缩</p> <p>gzip 压缩，找重复出现的字符串，临时替换，让整个文件变小，重复率越高压缩率越高 zlib 模块</p> <div class="language- extra-class"><pre class="language-text"><code>accept-encoding:gzip
</code></pre></div></li></ul> <ul><li><p>本地存储</p> <p>localStorage,sessionStorage,session,cookie,indexDB,cacheApi</p> <ol><li><p>cookie 不支持跨域 合理使用 cookie 否则会导致流量浪费</p></li> <li><p>localStorage / sessionStorage 不会发送给服务器</p></li> <li><p>IndexDB 浏览器中的非关系型数据库</p></li></ol> <p><a href="http://www.ruanyifeng.com/blog/2018/07/indexeddb.html" target="_blank" rel="noopener noreferrer">http://www.ruanyifeng.com/blog/2018/07/indexeddb.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ol start="4"><li>cacheApi 离线缓存</li></ol></li></ul> <ul><li><p>CDN</p> <p>内容分发网络 负载均衡 就近返回内容</p></li></ul> <ul><li><p>defer &amp; async ／ preload &amp; prefetch</p> <ul><li><p>defer 和 async 在网络读取的过程中都是异步解析</p></li> <li><p>defer 是有顺序依赖的，async 只要脚本加载完后就会执行</p></li> <li><p>preload 可以对当前页面所需的脚本、样式等资源进行预加载</p></li> <li><p>prefetch 加载的资源一般不是用于当前页面的，是未来很可能用到的这样一些资源</p></li></ul></li></ul> <h2 id="_4-http-状态码"><a href="#_4-http-状态码" class="header-anchor">#</a> 4.HTTP 状态码</h2> <p>1xx 信息性状态码 websocket upgrade</p> <p>2xx 成功状态码 200 204(没有响应体) 206(范围请求 暂停继续下载)</p> <p>3xx 重定向状态码 301 302 303 304 307</p> <p>4xx 客户端错误状态码 400 401 403 404 405</p> <p>5xx 服务端错误状态码 500 503</p> <h2 id="_5-http-服务创建"><a href="#_5-http-服务创建" class="header-anchor">#</a> 5. HTTP 服务创建</h2> <ul><li><p>url 模块的使用</p> <div class="language- extra-class"><pre class="language-text"><code>let {pathname,query} = url.parse(str,true);
</code></pre></div></li></ul> <ul><li><p>创建服务接受请求</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;request&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

req<span class="token punctuation">.</span>method<span class="token punctuation">;</span> <span class="token comment">// 请求方法</span>
req<span class="token punctuation">.</span>url<span class="token punctuation">;</span> <span class="token comment">// 请求路径</span>
req<span class="token punctuation">.</span>headers<span class="token punctuation">;</span> <span class="token comment">// 请求头</span>

req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取相应体</span>
req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// -------------------------</span>
res<span class="token punctuation">.</span>statusCode<span class="token punctuation">;</span> <span class="token comment">// 响应状态码</span>
res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置响应头</span>
res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 写响应体</span>
res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 结束响应体</span>
</code></pre></div></li> <li><p>客户端发送请求</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>http<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h2 id="_6-http-其他-header-的应用"><a href="#_6-http-其他-header-的应用" class="header-anchor">#</a> 6.Http 其他 header 的应用</h2> <p>用户内核：跳转不同网站</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>user <span class="token operator">-</span> agent<span class="token punctuation">;</span>
</code></pre></div><p>内容类型: 请求体解析/文件上传</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>content<span class="token operator">-</span>type<span class="token operator">:</span>multipart<span class="token operator">/</span>form<span class="token operator">-</span>data
content<span class="token operator">-</span>type<span class="token operator">:</span>application<span class="token operator">/</span>x<span class="token operator">-</span>www<span class="token operator">-</span>form<span class="token operator">-</span>urlencoded
content<span class="token operator">-</span>type<span class="token operator">:</span>application<span class="token operator">/</span>json
</code></pre></div><p>语言类型: 多语言</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>accept<span class="token operator">-</span>language<span class="token operator">:</span>zh<span class="token operator">-</span><span class="token constant">CN</span><span class="token punctuation">,</span>zh<span class="token punctuation">;</span>q<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span>en<span class="token punctuation">;</span>q<span class="token operator">=</span><span class="token number">0.8</span>
</code></pre></div><p>来源 header: 防盗链</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>referer <span class="token operator">/</span> referrer<span class="token punctuation">;</span>
</code></pre></div><p>host 主机: 反向代理</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>host<span class="token operator">:</span>a<span class="token punctuation">.</span>zhufeng<span class="token punctuation">.</span>cn<span class="token operator">:</span><span class="token number">81</span>
</code></pre></div><p>可以通过<code>http-proxy</code>这个库来实现代理，请求分发等。一台服务器上多个服务的做法就是默认都访问到<code>80</code>端口，<code>80</code>对应的是一台代理服务器，通过`host·的不同将请求分发到不同端口的服务上</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/web/chapter4/http/http-2.html" class="prev">HTTP中Header的应用</a></span> <span class="next"><a href="/web/chapter4/koa/">koa 原理</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/web/assets/js/app.86484ff8.js" defer></script><script src="/web/assets/js/2.977cf486.js" defer></script><script src="/web/assets/js/27.161a4fb8.js" defer></script>
  </body>
</html>
